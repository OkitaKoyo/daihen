<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Firebase_version9_RealtimeDB(G'sACADEMY初学者用サンプル)</title>
   <style>.remove:hover{background:aquamarine;}</style>
   <link rel="stylesheet" type="text/css" href="totonou.css">
<title>テンプレート</title>
</head>

<body>
  <header>
　　　  <h1>出席確認ページです</h1>
  </header>
  <div class="left-column">
<section>
<h1>書き残したいことがあったらどうぞ</h1>
  <div>名前<input type="text" id="uname"></div>
  <textarea id="text" cols="30" rows="10"></textarea>
<input type="button" value="button" onclick="buttonclick()">
   <button id="send">送信</button>　
 <form action="content.js" id = "form">

 </form>
   <div id="output"  class="log" style="overflow: auto; height :200px;"></div>
</section>
 </div>

   <div class="right-column">
<p id="syoumei">
        <p>        現在、この場所この時間で授業を受けてます</p>
        <div class="syoumeisyo">
     <select name="subject">
     <option value="教科1">教科1</option>
   <option value="教科2">教科2</option>
   <option value="教科3">教科3</option>
     </select>
     <select name="teacher">
     <option value="担任">担任1</option>
   <option value="担任">担任2</option>
   <option value="担任3">担任3</option>
     </select>
     <select name="time">
     <option value="1限目">１限目</option>
   <option value="2限目">２限目</option>
   <option value="3限目">３限目</option>
     </select>
        <p id="pointido"></p>
         <p id="pointkeido"></p>
          <p id="pointnow"></p>
          <h2>サイトから担当者へ</h2>
  </p>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, remove,onChildRemoved }
    from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    //TO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBuuSgl1iIjR66IO157cVIK5UUn_wJa5_I",
      authDomain: "sample-50c31.firebaseapp.com",
      projectId: "sample-50c31",
      storageBucket: "sample-50c31.appspot.com",
      messagingSenderId: "415603757646",
      appId: "1:415603757646:web:576951a373997d6ecc291f",
      measurementId: "G-PDK8CF9PKD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    //const dbRef = ref(db, "chat");
      const dbRef = ref(db, "chat");
      let h;

        'use strict';
      let lat;
      let lng ;
      let Slat;
      let Slng;
      let point = Slat + Slng;
    //データ登録(Click)
      $("#send").on("click",function() {
          const msg = {
              uname: $("#uname").val() ,
              text: $("#text").val()
          }
          const newPostRef = push(dbRef); //ユニークKEYを生成
          set(newPostRef, msg);           //"chat"にユニークKEYをつけてオブジェクトデータを登録
      });
  //データ登録(Enter)
  $("#text").on("keydown",function(e){
      console.log(e);        //e変数の中身を確認！！
      if(e.keyCode == 50){   //EnterKey=13
          const msg = {
              uname: $("#uname").val() ,
              text: $("#text").val()
          }
          const newPostRef = push(dbRef); //ユニークKEYを生成
          set(newPostRef, msg);           //"chat"にユニークKEYをつけてオブジェクトデータを登録
      }
  });

  onChildAdded(dbRef,function(data){
    const msg = data.val();
      const key = data.key;
          h = '<p>';
          h += msg.uname;
          h += '<br>';

          h+= msg.text;
          h+= '</p>';
          $("#output").append(h);

  });

  function success(pos) {
     lat = pos.coords.latitude;
      lng = pos.coords.longitude;
      Slat = "緯度"+String(lat);
        Slng = "経度"+String(lng);

      const now = new Date();
      const year = now.getFullYear();
      const month =now.getMonth();
      const date = now.getDate();
      const hour =now.getHours();
      const min =now.getMinutes();

        const output =`${year}/${month + 1}/${date} ${hour}:${min}`;

        $('#pointido').text(Slat);
          $('#pointkeido').text(Slng);
            $('#pointnow').text(output);

  }

  function fail(error) {
      alert('位置情報の取得に失敗しました。エラーコード：' + error.code);
  }

  navigator.geolocation.getCurrentPosition(success, fail);


  </script>
<script src="html2canvas.js"></script>
<script src="content.js"></script>
<script src="manifest.js"></script>

</body>
</html>
